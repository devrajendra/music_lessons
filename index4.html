<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>HighNote - Vocal Pitch Trainer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", sans-serif;
      background: linear-gradient(to right, #6a11cb, #2575fc);
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 40px 20px;
      min-height: 100vh;
      position: relative;
      overflow: hidden;
    }

    body.glow {
      animation: screenGlow 0.6s ease;
    }

    @keyframes screenGlow {
      0% { background: #fff; color: #000; }
      100% { background: linear-gradient(to right, #6a11cb, #2575fc); color: white; }
    }

    h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      animation: fadeIn 1s ease;
    }

    .tagline {
      font-size: 1.5em;
      font-weight: 500;
      margin-bottom: 30px;
      text-align: center;
      animation: fadeIn 1s ease;
    }

    #visualizer {
      font-size: 2.5em;
      margin-bottom: 20px;
      animation: bounce 1s infinite;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-12px); }
    }

    .hidden {
      display: none;
    }

    .shuffle-label {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 1.2em;
      margin: 20px 0 30px;
    }

    .shuffle-label input[type="checkbox"] {
      width: 22px;
      height: 22px;
      accent-color: #00e676;
      cursor: pointer;
    }

    select {
      font-size: 1.1em;
      padding: 12px 16px;
      border-radius: 8px;
      border: none;
      margin-bottom: 20px;
      width: 100%;
      max-width: 300px;
    }

    .button-group {
      display: flex;
      gap: 20px;
      margin-bottom: 30px;
      flex-wrap: wrap;
      justify-content: center;
    }

    button {
      font-size: 1.2em;
      padding: 15px 30px;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      transition: transform 0.2s ease;
      min-width: 140px;
    }

    button:hover {
      transform: scale(1.05);
    }

    button:active {
      transform: scale(0.97);
    }

    button.start {
      background-color: #00e676;
      color: #000;
    }

    button.stop {
      background-color: #ff1744;
      color: #fff;
    }

    #status {
      font-size: 1.3em;
      font-weight: 500;
      background: rgba(255, 255, 255, 0.15);
      padding: 10px 20px;
      border-radius: 12px;
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      margin-bottom: 10px;
    }

    #progressContainer {
      width: 100%;
      max-width: 300px;
      height: 16px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 20px;
      display: none;
    }

    #progressBar {
      height: 100%;
      width: 0%;
      background-color: #00e676;
      transition: width 0.3s ease;
    }

    #songComplete {
      font-size: 1.2em;
      margin-bottom: 20px;
      opacity: 0;
      transition: opacity 0.8s ease;
    }

    #songComplete.show {
      opacity: 1;
    }

    .balloon {
      position: absolute;
      bottom: -50px;
      width: 40px;
      height: 60px;
      background: radial-gradient(circle at center, #ff4081, #e91e63);
      border-radius: 50% 50% 50% 50%;
      animation: float 2.5s ease-out forwards;
    }

    @keyframes float {
      to {
        transform: translateY(-110vh) rotate(360deg);
        opacity: 0;
      }
    }

    @media (max-width: 500px) {
      button {
        padding: 12px 20px;
        font-size: 1em;
      }

      .tagline {
        font-size: 1.3em;
      }
    }
  </style>
</head>
<body>
  <h1>HighNote üé∂</h1>
  <p class="tagline">Train your voice with songs you love, in your range.</p>

  <div id="visualizer" class="hidden">üé§üé∂</div>

  <label for="songSelect" id="songLabel">Choose a song:</label>
  <select id="songSelect">
    <option value="greensleeves">Greensleeves</option>
    <option value="scarborough">Scarborough Fair</option>
    <option value="odetojoy">Ode to Joy</option>
    <option value="jollygoodfellow">Jolly Good Fellow</option>
    <option value="hoochycoochydance">Hoochy Coochy Dance</option>
    <option value="ohsusanna">Oh! Susanna</option>
  </select>

  <label class="shuffle-label">
    <input type="checkbox" id="shuffleMode" onchange="toggleSongSelectVisibility()">
    üéµ Shuffle All Songs (No Repeats)
  </label>

  <div class="button-group">
    <button class="start" onclick="startTraining()">‚ñ∂ Start</button>
    <button class="stop" onclick="stopTraining()">‚èπ Stop</button>
  </div>

  <div id="status">Ready</div>
  <div id="progressContainer"><div id="progressBar"></div></div>
  <div id="songComplete" class="hidden">‚úîÔ∏è Song Completed</div>

  <script>
    const songPitchRange = {
      greensleeves: { min: -4, max: 4 },
      scarborough: { min: -2, max: 2 },
      odetojoy: { min: -4, max: 1 },
      jollygoodfellow: { min: -4, max: 4 },
      hoochycoochydance: { min: -6, max: 3 },
      ohsusanna: { min: -4, max: 3 }
    };

    const allSongs = Object.keys(songPitchRange);
    let audio = new Audio();
    let isPlaying = false;
    let pitchSteps = [];
    let pitchStep = 0;
    let currentSong = "";
    let shuffleSongOrder = [];
    let shuffleIndex = 0;
    let inShuffleMode = false;

    function toggleSongSelectVisibility() {
      const shuffleChecked = document.getElementById("shuffleMode").checked;
      document.getElementById("songSelect").style.display = shuffleChecked ? "none" : "block";
      document.getElementById("songLabel").style.display = shuffleChecked ? "none" : "block";
    }

    function startTraining() {
      if (isPlaying) return;
      isPlaying = true;
      inShuffleMode = document.getElementById("shuffleMode").checked;
      document.getElementById("progressContainer").style.display = "block";

      if (inShuffleMode) {
        buildSongShuffleOrder();
        shuffleIndex = 0;
        playShuffledSong();
      } else {
        currentSong = document.getElementById("songSelect").value;
        const range = songPitchRange[currentSong];
        pitchSteps = buildPitchSteps(range.min, range.max);
        pitchStep = 0;
        playNextInSong();
      }
    }

    function stopTraining() {
      isPlaying = false;
      audio.pause();
      audio.currentTime = 0;
      document.getElementById("status").innerText = "Stopped";
      document.getElementById("visualizer").classList.add("hidden");
      document.getElementById("progressContainer").style.display = "none";
      document.getElementById("songComplete").classList.remove("show");
      document.getElementById("songComplete").classList.add("hidden");
    }

    function buildPitchSteps(min, max) {
      const steps = [];
      for (let i = min; i <= max; i++) steps.push(i);
      return steps;
    }

    function buildSongShuffleOrder() {
      shuffleSongOrder = [...allSongs];
      for (let i = shuffleSongOrder.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffleSongOrder[i], shuffleSongOrder[j]] = [shuffleSongOrder[j], shuffleSongOrder[i]];
      }
    }

    function playShuffledSong() {
      if (!isPlaying || shuffleIndex >= shuffleSongOrder.length) {
        isPlaying = false;
        document.getElementById("status").innerText = "Finished";
        document.getElementById("visualizer").classList.add("hidden");
        document.getElementById("progressContainer").style.display = "none";
        return;
      }

      currentSong = shuffleSongOrder[shuffleIndex];
      const range = songPitchRange[currentSong];
      pitchSteps = buildPitchSteps(range.min, range.max);
      pitchStep = 0;
      playNextInSong(true);
    }

    function playNextInSong(continueShuffle = false) {
      if (!isPlaying || pitchStep >= pitchSteps.length) {
        if (continueShuffle) {
          showSongCompleteMessage(currentSong);
          triggerBalloonExplosion();
          shuffleIndex++;
          setTimeout(playShuffledSong, 1800);
        }
        return;
      }

      const shift = pitchSteps[pitchStep];
      const fileName = `${currentSong}_${shift}.mp3`;

      document.getElementById("status").innerText = `Playing: ${capitalize(currentSong)}`;
      document.getElementById("visualizer").classList.remove("hidden");

      const progressPercent = ((pitchStep) / pitchSteps.length) * 100;
      document.getElementById("progressBar").style.width = progressPercent + "%";

      triggerGlowPulse();  // Add glow effect per pitch

      audio = new Audio(fileName);
      audio.play();

      pitchStep++;
      audio.onended = () => {
        if (isPlaying) playNextInSong(continueShuffle);
      };
    }

    function showSongCompleteMessage(songName) {
      const msg = document.getElementById("songComplete");
      msg.textContent = `‚úîÔ∏è Finished ${capitalize(songName)}`;
      msg.classList.remove("hidden");
      msg.classList.add("show");
      setTimeout(() => {
        msg.classList.remove("show");
        setTimeout(() => msg.classList.add("hidden"), 800);
      }, 1200);
    }

    function triggerGlowPulse() {
      document.body.classList.add("glow");
      setTimeout(() => document.body.classList.remove("glow"), 600);
    }

    function triggerBalloonExplosion() {
      for (let i = 0; i < 15; i++) {
        const balloon = document.createElement("div");
        balloon.classList.add("balloon");
        balloon.style.left = `${Math.random() * 100}%`;
        balloon.style.background = `hsl(${Math.random() * 360}, 70%, 60%)`;
        document.body.appendChild(balloon);
        setTimeout(() => balloon.remove(), 2500);
      }
    }

    function capitalize(word) {
      return word.charAt(0).toUpperCase() + word.slice(1);
    }
  </script>
</body>
</html>
